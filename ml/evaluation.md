# 机器学习：模型评估与优化学习指南

简明指南，覆盖评估指标、验证策略、调参与部署监控的实用要点，适用于监督学习与常见实际场景。

---

## 1 简介与目标
- 目标：可靠衡量模型质量、提升泛化能力、避免过拟合/欠拟合、在真实环境中稳定运行。
- 核心流程：数据准备 → 指标选择 → 验证策略 → 模型选择与调参 → 校准与解释 → 部署与监控。

---

## 2 数据与拆分策略
- 训练 / 验证 / 测试（典型比例 60/20/20 或 70/15/15）。
- 时间序列：使用时间切分（rolling / expanding window）。
- 类不平衡：分层抽样（stratify）或基于分布的划分。
- 数据泄露防范：所有预处理（scaling、feature engineering）在训练集拟合后应用于验证/测试。

---

## 3 常用评估指标
- 分类：
    - 准确率 Accuracy（不适合严重不平衡）。
    - 精确率 Precision、召回率 Recall、F1。
    - ROC-AUC、PR-AUC（不平衡时优先 PR-AUC）。
    - 混淆矩阵、类别别指标。
- 回归：
    - MSE / RMSE、MAE、R²。
    - 相对误差（MAPE，注意分母为0问题）。
- 排序/推荐：
    - NDCG、MAP、Precision@K、Recall@K。
- 校准：
    - Brier score、可靠性图（calibration curve）。

---

## 4 交叉验证与稳健估计
- K-fold CV（常用 k=5 或 10）；分层 CV 用于分类。
- 留一法（LOOCV）用于数据量极小或模型稳定性极高时。
- Nested CV：用于无偏估计调参后性能（外层用于评估，内层用于调参）。
- 重复 CV 或引入随机种子以量化方差。

---

## 5 偏差—方差权衡
- 低偏差高方差：过拟合 → 增加正则化、简化模型、更多数据。
- 高偏差低方差：欠拟合 → 增加模型容量、特征工程、降低正则化。
- 学习曲线（训练/验证误差随训练样本数变化）诊断方向。

---

## 6 超参数优化
- 网格搜索 GridSearch / 随机搜索 RandomSearch。
- 贝叶斯优化（Optuna、Hyperopt）、基于树的 Parzen Estimator。
- 早停（early stopping）减少过拟合和计算成本。
- 并行化与多次重复以减少噪声影响。

---

## 7 正则化与泛化技巧
- L1/L2、Dropout（NN）、数据增强、集成方法（bagging/boosting）。
- 特征选择：基于重要性、递归特征消除、嵌入式方法。
- 校准（Platt scaling、isotonic regression）用于概率输出调整。

---

## 8 模型解释性与诊断
- 局部解释：SHAP、LIME。
- 全局解释：特征重要度、部分依赖图（PDP）。
- 错误分析：按子群/特征检查性能差异，识别数据质量问题。

---

## 9 实验管理与可重复性
- 固定随机种子、保存训练/验证拆分、记录超参数与版本控制（代码与数据）。
- 使用实验跟踪工具（MLflow、Weights & Biases）。
- 保存模型与元数据（训练时间、环境、依赖）。

---

## 10 部署后监控与在线评估
- 指标监控：数据漂移、概念漂移、性能衰减。
- A/B 测试与多臂赌博机用于线上评估新模型。
- 回滚机制与灰度发布，得分阈值审慎调整。

---

## 11 常见陷阱
- 在验证集中调参导致信息泄露（需用 nested CV 或独立测试集）。
- 仅用单一指标决策；应结合业务目标。
- 忽视样本权重或不平衡问题。
- 忽视推断时延与资源限制（工程约束）。

---

## 12 快速检查清单（部署前）
- 数据泄露检测通过？
- 验证集/测试集与训练集独立？
- 评估指标与业务目标一致？
- 模型经过校准和解释性检查？
- 监控指标与报警已配置？

---

## 13 学习资源（入门/进阶）
- 官方文档：scikit-learn、XGBoost、LightGBM。
- 文章/书籍：机器学习实践、模型评估专题文章与博客（搜索“model evaluation best practices”）。
- 工具：scikit-learn、Optuna、MLflow、SHAP、Prometheus（监控）。

---

## 14 快速示例（要点）
- 若二分类且数据不平衡：优先 PR-AUC、使用分层 CV、考虑上采样/类权重与阈值优化。
- 回归有异常值：考虑 MAE 或稳健回归并对误差分布建模。

---

结束语：先定义好业务指标与数据拆分，再选择合适的验证与调参策略；持续监控与迭代是模型长期成功的关键。